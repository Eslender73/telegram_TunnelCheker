### **ربات تلگرامی مانیتورینگ شبکه (TunnelCheker)** ###



ربات تلگرامی TunnelCheker یک ابزار قدرتمند و خودکار برای نظارت بر وضعیت پایدار شبکه و سرورهای شماست. این ربات در بازه‌های زمانی مشخص، سرورهای تعریف‌شده را پینگ کرده و وضعیت پکت لاست (Packet Loss) را به دقت بررسی می‌کند. در صورت عبور پکت لاست از آستانه‌ی تعریف‌شده (شناسایی قطعی) یا بازگشت به حالت پایدار (رفع مشکل)، ربات به‌صورت خودکار گزارش‌هایی دقیق و کامل به کانال یا گروه تلگرامی شما ارسال می‌کند.

این پروژه با یک اسکریپت مدیریت هوشمند ارائه می‌شود که فرآیند نصب، پیکربندی، حذف و پشتیبان‌گیری را از طریق یک منوی تعاملی (TUI) بسیار ساده کرده است.

💎 ویژگی‌های کلیدی

✅ پینگ هوشمند: بررسی دوره‌ای سرورهای مقصد بر اساس آدرس IPv4 و IPv6 برای پکت لاست و زمان پاسخگویی.

⚠️ گزارش خرابی فوری: ارسال آنی هشدار به تلگرام در صورت بروز قطعی و عبور پکت لاست از آستانه مجاز.

🎉 اطلاع‌رسانی رفع مشکل: ارسال گزارش خودکار پس از پایدار شدن وضعیت و بازگشت پکت لاست به صفر.

⚙️ معماری Master/Client: قابلیت نصب در دو حالت کلاینت (برای پینگ کردن روی سرورهای مختلف) و مستر (برای دریافت گزارش‌ها و ارسال به تلگرام)، که امکان مدیریت متمرکز ده‌ها سرور را فراهم می‌کند.

🚀 نصب و مدیریت آسان: یک اسکریپت مدیریت جامع (manager.sh) با منوی تعاملی برای انجام تمام کارها از جمله:

نصب خودکار پیش‌نیازها

انتخاب حالت نصب (Master یا Client)

ویرایش فایل‌های کانفیگ

حذف کامل برنامه

پشتیبان‌گیری و بازگردانی تنظیمات

🔧 تنظیمات انعطاف‌پذیر: تمام پارامترها از طریق فایل‌های JSON قابل تنظیم هستند (زمان پینگ، تعداد بسته‌ها، لیست سرورها، توکن ربات و...).

📄 ذخیره لاگ‌ها: تمام رویدادها، پینگ‌ها و خطاهای احتمالی در فایل‌های لاگ برای بررسی‌های بعدی ذخیره می‌شوند.

🏛️ معماری سیستم (Master/Client)

این ابزار می‌تواند در دو حالت مختلف نصب و اجرا شود:


حالت Client

وظیفه: اجرای پینگ‌های دوره‌ای روی سرورهای تعریف‌شده در فایل config.json.

محل نصب: روی هر سروری که می‌خواهید از آن پینگ به مقصدهای دیگر انجام شود.

عملکرد: کلاینت پس از انجام پینگ، نتایج را برای سرور Master ارسال می‌کند. چندین کلاینت می‌توانند گزارش‌های خود را به یک سرور Master ارسال کنند.

حالت Master

وظیفه: دریافت و تحلیل داده‌های ارسالی از تمام کلاینت‌ها.

محل نصب: روی یک سرور مرکزی.

عملکرد: سرور Master قلب سیستم اطلاع‌رسانی است. این سرور پس از دریافت گزارش از کلاینت‌ها، وضعیت پکت لاست را بررسی کرده و در صورت نیاز، پیام هشدار یا رفع مشکل را از طریق ربات تلگرام به کانال یا گروه مشخص‌شده ارسال می‌کند.

🛠️ نصب و راه‌اندازی

نصب این پروژه به لطف اسکریپت مدیریت هوشمند، تنها با یک دستور انجام می‌شود.


پیش‌نیازها

یک سرور یا ماشین مجازی با سیستم‌عامل Debian یا Ubuntu.

دسترسی sudo یا root.

نصب بودن curl روی سیستم (sudo apt-get install curl).

اجرای دستور نصب

کافیست دستور زیر را در ترمینال سرور خود وارد و اجرا کنید:

TunnelCheker script:
```bash
bash -c "$(curl -fsSL Https://raw.githubusercontent.com/Eslender73/telegram_TunnelCheker/main/manager.sh)"
```
مراحل نصب تعاملی

پس از اجرای دستور بالا، منوی مدیریت نمایش داده می‌شود و شما را گام به گام راهنمایی می‌کند:

انتخاب گزینه 1) Install TunnelCheker: از منوی اصلی، گزینه‌ی نصب را انتخاب کنید.

انتخاب نوع نصب: از شما پرسیده می‌شود که می‌خواهید این سرور به عنوان Master یا Client نصب شود.

کپی فایل‌ها و نصب پیش‌نیازها: اسکریپت به صورت خودکار فایل‌های مورد نیاز را از گیت‌هاب دانلود کرده، پیش‌نیازهایی مانند python3-pip و jq را نصب می‌کند و کتابخانه‌های پایتون لازم را فراهم می‌سازد.

انتخاب روش پیکربندی: از شما پرسیده می‌شود که آیا می‌خواهید:

کانفیگ را دستی انجام دهید؟ (با این انتخاب، فایل‌های کانفیگ در ویرایشگر nano باز می‌شوند تا اطلاعات خود را وارد کنید).

از یک بکاپ بازگردانی کنید؟ (اگر قبلاً از تنظیمات خود پشتیبان گرفته‌اید).

راه‌اندازی سرویس: پس از انجام پیکربندی، اسکریپت به صورت خودکار یک سرویس systemd به نام tunnelmonitor.service ایجاد و آن را فعال و اجرا می‌کند تا برنامه همیشه در پس‌زمینه در حال اجرا باشد.

نصب دستور سراسری: در انتها، اسکریپت مدیریت به عنوان یک دستور سراسری به نام manager نصب می‌شود تا از هر جای سیستم به راحتی به منوی مدیریت دسترسی داشته باشید.

⚙️ نحوه استفاده و مدیریت

پس از نصب، کافیست در هر مسیری از ترمینال خود دستور زیر را وارد کنید تا منوی مدیریت دوباره نمایش داده شود:


```Bash
manager
```
این منو گزینه‌های زیر را در اختیار شما قرار می‌دهد:


Install TunnelCheker: برای نصب اولیه (در صورتی که برنامه نصب نباشد).

Edit Configuration: برای ویرایش سریع فایل‌های config.json یا master_config.json. پس از ذخیره، سرویس به صورت خودکار ری‌استارت می‌شود.

Uninstall TunnelCheker: برای حذف کامل برنامه و سرویس systemd. این گزینه از شما می‌پرسد که آیا مایل به نگهداری فایل‌های کانفیگ خود هستید یا خیر.

Restore Backup: برای مشاهده لیست پشتیبان‌های موجود و بازگردانی تنظیمات از یک نسخه پشتیبان خاص.

Exit: برای خروج از برنامه.

📝 پیکربندی (Configuration)

تنظیمات اصلی از طریق دو فایل JSON انجام می‌شود.


۱. فایل config.json (برای Master و Client)

این فایل حاوی اطلاعات سروری است که اسکریپت روی آن اجرا می‌شود و همچنین لیست مقصدهایی که باید پینگ شوند.

مثال:

```JSON

{
  "CLname": "Germany-Hetzner",
  "CLipv4": "***.***.***.***",
  "ID_ip4/ip6_name": [
    "***.***.***.***,Server-1",
    "***.***.***.***,Server-2",
    "***.***.***.***,Server-3"
  ],
  "ping_interval_seconds": 60,
  "packet_count": 10,
  "packet_loss_threshold_percent": 20,
  "Master_server_info": "master server ip:port"  #(Clients)
}
```
توضیحات فایل config.json :
```JSON
CLname: نام دلخواه برای سرور کلاینت (مثلاً نام دیتاسنتر).
CLipv4: آدرس IPv4 سروری که کلاینت روی آن نصب است.
ID_ip4/ip6_name: لیستی از سرورهایی که باید پینگ شوند. هر آیتم یک رشته با فرمت "ID,IPv4,IPv6,Name" است.
ID: یک شماره منحصر به فرد برای هر سرور.
IPv4: آدرس IPv4 مقصد.
IPv6: آدرس IPv6 مقصد (اگر وجود ندارد خالی بگذارید).
Name: نام دلخواه برای سرور مقصد.
ping_interval_seconds: فاصله زمانی بین هر بار پینگ (به ثانیه).
packet_count: تعداد بسته‌هایی که در هر پینگ ارسال می‌شود.
packet_loss_threshold_percent: آستانه مجاز پکت لاست (به درصد). اگر پکت لاست از این مقدار بیشتر شود، پیام هشدار ارسال می‌گردد.
master server ip:port: در سرور های کلاینت برای ارسال داده به سرور مستر .مشخصات ایپی و پورت سرور مستر
```
۲. فایل master_config.json (فقط برای Master)

این فایل حاوی اطلاعات محرمانه ربات تلگرام است و فقط روی سرور Master استفاده می‌شود.


مثال:

```JSON


  "listen_port": 9090,
  "report_timeout_minute": 15,
  "expected_clients": {
    "Number of Servers": {
      "CLipv4_M": "************",
      "CLname_M": "Germany-Hetzner",
      "tests": {
        "1": "Server-1",
        "2": "Server-2",
        "3": "Server-3"
      }
    }
{
  "telegram_bot_token": "************",
  "telegram_chat_id": "************"
}
```
توضیحات فایل master_config.json :
```JSON
listen_port: پورت برای دریافت اطلاعات از سرور های کلاینت
report_timeout_minute: مقدار زمان تایم اوت در یافت نکردن اطلاعات
expected_clients: سرور هایی که مستر انتظار دارد از انها اطلاعاتی دریافت کند که در صورت دریافت نشدن اطلاعات ان را نمایش دهد
telegram_bot_token: توکن ربات تلگرامی شما که از BotFather دریافت کرده‌اید.
telegram_chat_id: شناسه چت، کانال یا گروهی که می‌خواهید گزارش‌ها به آنجا ارسال شود.
Number of Servers:زیرا که سرور مستر به صورت پیش فرض یک سرور کلاینت حساب و مورد تست قرار میگیرد ، پس این مقدار با عدد 2 شروع میگردد
```
🌳 ساختار پروژه

فایل‌های اصلی پروژه به صورت زیر سازماندهی شده‌اند:

```
.
├── Client/
│   ├── config.json
│   ├── ping.py
│   ├── sender.py
├── master/
│   ├── bot.py
│   ├── config.json
│   ├── master_config.json
│   ├── message_id.txt
│   └── ... (سایر فایل‌های اجرایی و لاگ)
```
🤝 این پروژه با کمک هوش مصنوعی درست شده است بنابراین ممکن است چیزهایی درون آن رعایت نشده باشد در صورتی که قادر بودید میتونید آن را فورک و تکمیل کنید.
